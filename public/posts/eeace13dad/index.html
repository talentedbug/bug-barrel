<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Clash 配置文件简述 | 桶装幺蛾子</title>
<meta name="keywords" content="">
<meta name="description" content="最近本蛾子发现之前搭建的代理，访问部分国内网站的时候不光速度很慢，而且有时候会报 PR_END_OF_FILE_ERROR（无法确定内容完整性，就是远程，特别是 CSDN，全站都无法访问。

😮‍💨 唉：后来发现其实是服务端 WARP 的问题，跟 v2rayA 一毛钱关系都没有。

本蛾子现在使用的 v2rayA 虽然安装起来很方便（Arch Linux CN 有打包），但是对于规则的支持并不算好，并且开启、关闭、切换节点的速度也不尽人意。在网上搜索一通，似乎眼下最完善的内核是 Clash 系列的后继者 Mihomo，因此本蛾子就用它来学习一下如何书写 Clash 配置文件。
💻 客户端选择
Clash 系的客户端在 AUR 上基本全部都有打包。根据本蛾子的测试，似乎还在开发且可用性比较高的，只有 Clash Verge Rev 和 FlClash，而后者的 UI 设计本蛾子看着非常舒服，因此本文就以 FlClash 作为测试客户端。
首先对 FlClash 的软件设置进行调整。虽然诸多 Clash 系客户端使用同一个内核，但是其 UI 设计却千差万别。FlClash 的界面大概是这样的。

在 Tools 栏目中，主要是软件本身和覆写配置文件的选项，前者是主题、日志、自动启动等本地定义的选项，不出现在配置文件中，因此我们首先来完成对其的设置。覆写配置文件的设置主要针对使用远程配置文件（例如机场）的用户，方便修改配置文件。

选项大部分您都应该能理解，说几个比较迷惑的：

Logcat：就是日志功能，记录您使用代理访问的网站，关闭之后不会记录，但是似乎需要手动删除之前的记录（位于您的主目录下）。
Auto lost connections：在切换节点之后切断当前存在的连接，开启之后换区域会更加彻底，但是您的下载会被终端。
Only statistics proxy：只对通过的流量进行记录，这时候 FlClash 就变成了一个网络监测工具。

当然这个栏目还有其他功能，比如设置语言、主题、备份之类的，就请您自己探索了。
⚙️ 配置文件
这当然就是本文的重点了！通过 Clash 配置文件，您可以方便地修改 DNS、分流、（基础）去广告等，至于节点链接，倒成了配置文件中不太重要的一部分了。下面本蛾子参考了一些链接和项目，为行文流畅就不一一列出角标了，一并在文末引用。
您书写的配置文件应当保存在任意名称的 .yaml 文件中，在 FlClash 中这样引用：">
<meta name="author" content="智慧的幺蛾子">
<link rel="canonical" href="http://localhost:1313/posts/eeace13dad/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.75cc0bc8b7e49d1131c6aa01c8e0ffc243167dd94130253a953494bccdeba2cb.css" integrity="sha256-dcwLyLfknRExxqoByOD/wkMWfdlBMCU6lTSUvM3ross=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.jpg">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon.jpg">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon.jpg">
<link rel="apple-touch-icon" href="http://localhost:1313/favicon.jpg">
<link rel="mask-icon" href="http://localhost:1313/favicon.jpg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh-cn" href="http://localhost:1313/posts/eeace13dad/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/eeace13dad/">
  <meta property="og:site_name" content="桶装幺蛾子">
  <meta property="og:title" content="Clash 配置文件简述">
  <meta property="og:description" content="最近本蛾子发现之前搭建的代理，访问部分国内网站的时候不光速度很慢，而且有时候会报 PR_END_OF_FILE_ERROR（无法确定内容完整性，就是远程，特别是 CSDN，全站都无法访问。
😮‍💨 唉：后来发现其实是服务端 WARP 的问题，跟 v2rayA 一毛钱关系都没有。
本蛾子现在使用的 v2rayA 虽然安装起来很方便（Arch Linux CN 有打包），但是对于规则的支持并不算好，并且开启、关闭、切换节点的速度也不尽人意。在网上搜索一通，似乎眼下最完善的内核是 Clash 系列的后继者 Mihomo，因此本蛾子就用它来学习一下如何书写 Clash 配置文件。
💻 客户端选择 Clash 系的客户端在 AUR 上基本全部都有打包。根据本蛾子的测试，似乎还在开发且可用性比较高的，只有 Clash Verge Rev 和 FlClash，而后者的 UI 设计本蛾子看着非常舒服，因此本文就以 FlClash 作为测试客户端。
首先对 FlClash 的软件设置进行调整。虽然诸多 Clash 系客户端使用同一个内核，但是其 UI 设计却千差万别。FlClash 的界面大概是这样的。
在 Tools 栏目中，主要是软件本身和覆写配置文件的选项，前者是主题、日志、自动启动等本地定义的选项，不出现在配置文件中，因此我们首先来完成对其的设置。覆写配置文件的设置主要针对使用远程配置文件（例如机场）的用户，方便修改配置文件。
选项大部分您都应该能理解，说几个比较迷惑的：
Logcat：就是日志功能，记录您使用代理访问的网站，关闭之后不会记录，但是似乎需要手动删除之前的记录（位于您的主目录下）。 Auto lost connections：在切换节点之后切断当前存在的连接，开启之后换区域会更加彻底，但是您的下载会被终端。 Only statistics proxy：只对通过的流量进行记录，这时候 FlClash 就变成了一个网络监测工具。 当然这个栏目还有其他功能，比如设置语言、主题、备份之类的，就请您自己探索了。
⚙️ 配置文件 这当然就是本文的重点了！通过 Clash 配置文件，您可以方便地修改 DNS、分流、（基础）去广告等，至于节点链接，倒成了配置文件中不太重要的一部分了。下面本蛾子参考了一些链接和项目，为行文流畅就不一一列出角标了，一并在文末引用。
您书写的配置文件应当保存在任意名称的 .yaml 文件中，在 FlClash 中这样引用：">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-12-29T09:39:37+08:00">
    <meta property="article:modified_time" content="2024-12-29T09:39:37+08:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Clash 配置文件简述">
<meta name="twitter:description" content="最近本蛾子发现之前搭建的代理，访问部分国内网站的时候不光速度很慢，而且有时候会报 PR_END_OF_FILE_ERROR（无法确定内容完整性，就是远程，特别是 CSDN，全站都无法访问。

😮‍💨 唉：后来发现其实是服务端 WARP 的问题，跟 v2rayA 一毛钱关系都没有。

本蛾子现在使用的 v2rayA 虽然安装起来很方便（Arch Linux CN 有打包），但是对于规则的支持并不算好，并且开启、关闭、切换节点的速度也不尽人意。在网上搜索一通，似乎眼下最完善的内核是 Clash 系列的后继者 Mihomo，因此本蛾子就用它来学习一下如何书写 Clash 配置文件。
💻 客户端选择
Clash 系的客户端在 AUR 上基本全部都有打包。根据本蛾子的测试，似乎还在开发且可用性比较高的，只有 Clash Verge Rev 和 FlClash，而后者的 UI 设计本蛾子看着非常舒服，因此本文就以 FlClash 作为测试客户端。
首先对 FlClash 的软件设置进行调整。虽然诸多 Clash 系客户端使用同一个内核，但是其 UI 设计却千差万别。FlClash 的界面大概是这样的。

在 Tools 栏目中，主要是软件本身和覆写配置文件的选项，前者是主题、日志、自动启动等本地定义的选项，不出现在配置文件中，因此我们首先来完成对其的设置。覆写配置文件的设置主要针对使用远程配置文件（例如机场）的用户，方便修改配置文件。

选项大部分您都应该能理解，说几个比较迷惑的：

Logcat：就是日志功能，记录您使用代理访问的网站，关闭之后不会记录，但是似乎需要手动删除之前的记录（位于您的主目录下）。
Auto lost connections：在切换节点之后切断当前存在的连接，开启之后换区域会更加彻底，但是您的下载会被终端。
Only statistics proxy：只对通过的流量进行记录，这时候 FlClash 就变成了一个网络监测工具。

当然这个栏目还有其他功能，比如设置语言、主题、备份之类的，就请您自己探索了。
⚙️ 配置文件
这当然就是本文的重点了！通过 Clash 配置文件，您可以方便地修改 DNS、分流、（基础）去广告等，至于节点链接，倒成了配置文件中不太重要的一部分了。下面本蛾子参考了一些链接和项目，为行文流畅就不一一列出角标了，一并在文末引用。
您书写的配置文件应当保存在任意名称的 .yaml 文件中，在 FlClash 中这样引用：">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Clash 配置文件简述",
      "item": "http://localhost:1313/posts/eeace13dad/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Clash 配置文件简述",
  "name": "Clash 配置文件简述",
  "description": "最近本蛾子发现之前搭建的代理，访问部分国内网站的时候不光速度很慢，而且有时候会报 PR_END_OF_FILE_ERROR（无法确定内容完整性，就是远程，特别是 CSDN，全站都无法访问。\n😮‍💨 唉：后来发现其实是服务端 WARP 的问题，跟 v2rayA 一毛钱关系都没有。\n本蛾子现在使用的 v2rayA 虽然安装起来很方便（Arch Linux CN 有打包），但是对于规则的支持并不算好，并且开启、关闭、切换节点的速度也不尽人意。在网上搜索一通，似乎眼下最完善的内核是 Clash 系列的后继者 Mihomo，因此本蛾子就用它来学习一下如何书写 Clash 配置文件。\n💻 客户端选择 Clash 系的客户端在 AUR 上基本全部都有打包。根据本蛾子的测试，似乎还在开发且可用性比较高的，只有 Clash Verge Rev 和 FlClash，而后者的 UI 设计本蛾子看着非常舒服，因此本文就以 FlClash 作为测试客户端。\n首先对 FlClash 的软件设置进行调整。虽然诸多 Clash 系客户端使用同一个内核，但是其 UI 设计却千差万别。FlClash 的界面大概是这样的。\n在 Tools 栏目中，主要是软件本身和覆写配置文件的选项，前者是主题、日志、自动启动等本地定义的选项，不出现在配置文件中，因此我们首先来完成对其的设置。覆写配置文件的设置主要针对使用远程配置文件（例如机场）的用户，方便修改配置文件。\n选项大部分您都应该能理解，说几个比较迷惑的：\nLogcat：就是日志功能，记录您使用代理访问的网站，关闭之后不会记录，但是似乎需要手动删除之前的记录（位于您的主目录下）。 Auto lost connections：在切换节点之后切断当前存在的连接，开启之后换区域会更加彻底，但是您的下载会被终端。 Only statistics proxy：只对通过的流量进行记录，这时候 FlClash 就变成了一个网络监测工具。 当然这个栏目还有其他功能，比如设置语言、主题、备份之类的，就请您自己探索了。\n⚙️ 配置文件 这当然就是本文的重点了！通过 Clash 配置文件，您可以方便地修改 DNS、分流、（基础）去广告等，至于节点链接，倒成了配置文件中不太重要的一部分了。下面本蛾子参考了一些链接和项目，为行文流畅就不一一列出角标了，一并在文末引用。\n您书写的配置文件应当保存在任意名称的 .yaml 文件中，在 FlClash 中这样引用：\n",
  "keywords": [
    
  ],
  "articleBody": "最近本蛾子发现之前搭建的代理，访问部分国内网站的时候不光速度很慢，而且有时候会报 PR_END_OF_FILE_ERROR（无法确定内容完整性，就是远程，特别是 CSDN，全站都无法访问。\n😮‍💨 唉：后来发现其实是服务端 WARP 的问题，跟 v2rayA 一毛钱关系都没有。\n本蛾子现在使用的 v2rayA 虽然安装起来很方便（Arch Linux CN 有打包），但是对于规则的支持并不算好，并且开启、关闭、切换节点的速度也不尽人意。在网上搜索一通，似乎眼下最完善的内核是 Clash 系列的后继者 Mihomo，因此本蛾子就用它来学习一下如何书写 Clash 配置文件。\n💻 客户端选择 Clash 系的客户端在 AUR 上基本全部都有打包。根据本蛾子的测试，似乎还在开发且可用性比较高的，只有 Clash Verge Rev 和 FlClash，而后者的 UI 设计本蛾子看着非常舒服，因此本文就以 FlClash 作为测试客户端。\n首先对 FlClash 的软件设置进行调整。虽然诸多 Clash 系客户端使用同一个内核，但是其 UI 设计却千差万别。FlClash 的界面大概是这样的。\n在 Tools 栏目中，主要是软件本身和覆写配置文件的选项，前者是主题、日志、自动启动等本地定义的选项，不出现在配置文件中，因此我们首先来完成对其的设置。覆写配置文件的设置主要针对使用远程配置文件（例如机场）的用户，方便修改配置文件。\n选项大部分您都应该能理解，说几个比较迷惑的：\nLogcat：就是日志功能，记录您使用代理访问的网站，关闭之后不会记录，但是似乎需要手动删除之前的记录（位于您的主目录下）。 Auto lost connections：在切换节点之后切断当前存在的连接，开启之后换区域会更加彻底，但是您的下载会被终端。 Only statistics proxy：只对通过的流量进行记录，这时候 FlClash 就变成了一个网络监测工具。 当然这个栏目还有其他功能，比如设置语言、主题、备份之类的，就请您自己探索了。\n⚙️ 配置文件 这当然就是本文的重点了！通过 Clash 配置文件，您可以方便地修改 DNS、分流、（基础）去广告等，至于节点链接，倒成了配置文件中不太重要的一部分了。下面本蛾子参考了一些链接和项目，为行文流畅就不一一列出角标了，一并在文末引用。\n您书写的配置文件应当保存在任意名称的 .yaml 文件中，在 FlClash 中这样引用：\n🏠 基础 Clash 配置文件使用 YAML 的语法，以 key: value 的形式书写，注意中间的空格不可以省略。如果一个键有子键，那么需要缩进并添加 -；注释以 # 开头。示例请见下文说明。\n一个 Clash 配置文件类似于这样：\nmixed-port: 7890 allow-lan: false # bind-address: \"*\" ipv6: true mode: rule log-level: info # external-controller: 127.0.0.1:9090 # secret:\"\" dns: proxies: proxy-groups: rules: 每一个选项的含义：\nmixed-port：混合端口，即 Clash 内核所使用的端口，支持 HTTP、SOCKS 等代理协议混用。 allow-lan：是否允许局域网连接，如果您希望连接其他设备可以连接代理，您应当将其设置为 true，公用网络下无论如何都应当设置为 false 来保证安全。 bind-address：绑定地址，在 allow-lan: true 的情况下，端口允许的地址，例如 0.0.0.0 代表您设备在网络中的 IP 地址（所有 IPv4 设备均可连接），127.0.0.1 代表回环地址（只有本机可以连接），:: 代表您设备的 IPv6 地址等等；设置为 \"*\" 即允许所有设备连接。 ipv6：是否启用 IPv6，这要看您路由器是否支持。设为 true 没啥坏处。 mode：模式，接下来我们将使用规则集，因此要设成 rule 即规则模式。其他还有 direct（不走代理）和 global（全走代理）。 log-level：日志等级，info 比较适中，也可设成 error（仅错误）、warning（错误和警告）、debug（所有记录）、silent（不输出）。 external-controller 和 secret：控制端口和密码，非常建议设置为 127.0.0.1 而非 0.0.0.0，后者将把控制界面向局域网开放。 其他的是接下来讨论的重点。 当然其实还有个 authentication 即代理认证功能，请您自行查阅文末引用，有详细介绍。本文主要讨论作为本地代理的功能，不过度介绍。\n🗺️ DNS 在上述配置中继续添加。\nDNS 是互联网上用于查找域名对应 IP 地址的工具，您在浏览器中输入的所有域名都会被发送到 DNS 服务器解析，然后再访问 IP。由于纯 DNS 使用的是未经加密的 UDP 包，非常容易被污染篡改，早年间的 GFW 主要就采用 DNS 污染的方式封禁域名。\n说实话，本蛾子建议您就算不使用代理，也按照下文方法（在 FlClash 或操作系统中）设置安全的 DNS 方案，详情请见文末引用的部分文章。\n但是后来由于 DoH 即 DNS over HTTPS 技术的出现（其实还有 HTTPS 本身），GFW 原本准确的 DNS 污染和选择性屏蔽页面形同虚设，就开始使用 IP 黑洞这种最简单、最暴力的方法屏蔽一些网站。\n当然对于 Cloudflare 这种 IP 大户还是没什么用，于是对于 *.pages.dev 和 *.workers.dev 又开始了域名封锁。\n无论如何，您在使用代理时，最好还是要添加一下 DNS 配置。例如：\ndns: enable: true prefer-h3: true use-hosts: true use-system-hosts: true respect-rules: false listen: 0.0.0.0:1053 ipv6: false enhanced-mode: fake-ip fake-ip-range: 198.18.0.1/16 # fake-ip-filter: # - '*.lan' # - \"+.local\" # - localhost.ptlogin2.qq.com default-nameserver: - 8.8.8.8 - 1.1.1.1 - 223.5.5.5 - 119.29.29.29 # nameserver-policy: # 'www.baidu.com': '114.114.114.114' # '+.internal.crop.com': '10.0.0.1' # 'geosite:cn,private': # - https://223.5.5.5/dns-query # - https://223.6.6.6/dns-query nameserver: - https://dns.alidns.com/dns-query - https://doh.pub/dns-query proxy-server-nameserver: - https://dns.alidns.com/dns-query - https://doh.pub/dns-query fallback: - https://dns.google/dns-query - https://cloudflare-dns.com/dns-query - 8.8.8.8 - 1.1.1.1 fallback-filter: geoip: true geoip-code: CN geosite: - gfw ipcidr: - 240.0.0.0/4 - 0.0.0.0/32 - 127.0.0.1/32 # domain: # - '+.google.com' # - '+.facebook.com' # - '+.youtube.com' 简单解释一下：\nenable：启用 DNS 设置。\nprefer-h3：加密的、使用 QUIC 实现的 DNS 协议，有助于加快查询速度。\nuse-hosts 和 use-system-hosts：是否使用 hosts 优先查询。hosts 是独立于 DNS 系统的查询文件，一般在操作系统中定义，可以把某些地址强制解析到特定 IP 上，例如实际上 localhost 这个地址并不存在，是操作系统在 hosts 中定义了 127.0.0.1 localhost。建议开启。\nrespect-rules：优先遵守下文规则的设置，如果您使用机场，不建议开启，因为如果机场定义了 DNS 设置会导致您的配置失效。（如果没有，就无所谓了，这玩意儿就成了「自尊」😄）\nfake-ip-*：这是个比较有意思的东西。正常来说，浏览器查询 DNS 服务器，得到 IP，然后访问；但是如果 Clash 开启了 fake-ip，浏览器得到 Clash 的解析结果都指向 fake-ip-range 中的一个随机地址，然后对其发送请求，再由 Clash 来请求服务端。\n由此也可以发现，Clash 运行时一定会劫持 DNS，所以如果您发现 DNS 设置不正常，不必惊慌。\nfake-ip-filter 还可以定义不使用 fake-ip 的地址，一般不需要，除了 QQ 对于本地的请求也使用域名……\ndefault-nameserver：如果定义了 nameserver，此配置将用于解析 DoH 域名，从上至下轮询直到得到第一个结果。由于我们使用代理，就优先选择国外服务；如果您想配置不开代理的 DoH，需要将国内的几个调到上面。\nDoH 地址也是域名，也需要解析……所以有的时候称为「引导域名服务器」。\nnameserver：默认 DNS 服务器，但是由于下文设置了 fallback-filter，所有 GeoIP 非 CN 的域名实际上会采用 fallback，因此这里仅针对国内网站。\nnameserver-policy：域名解析规则，对于特定域名采用指定 DNS 服务器。\nproxy-server-nameserver：用于解析代理服务器域名的 DNS 服务器，建议设国内地址，因为这个流量不走代理。\nfallback：后备 DNS 服务器。若第一轮解析结果显示其 GeoIP 非 CN，则使用这些服务器验证。\nfallback-filter：过滤器，负责决定哪些域名需要使用 fallback 验证：\ngeoip-code：除了该国家代码的解析结果，全部视为已经污染，进入 fallback。\ngeosite：在列表中的全部视为污染，进入 fallback。\nipcidr：如果解析结果是这些网段，则认为是污染。\n这是因为 GFW 在 DNS 污染之后还是要返回结果的，通常就是回环地址或者不存在的 IP，因此可以根据这一点来判断是否被污染。文末的维基学院参考提供了一个污染返回的结果列表，但是本蛾子未采用，因为该列表有极大概率滥杀无辜 😮‍💨\ndomain：对于这些域名，直接使用 fallback。\n👷‍♂️ 代理 这里你应当填写你的订阅链接。如果您获得的链接是类似于 vless://... 的格式，您需要先进行转换。下面本蛾子给出一个示范。\n对于 vless://[UUID]@[DOMAIN]:[PORT]?encryption=[ENCRYPTION]\u0026security=[SECURITY]\u0026type=[TYPE]\u0026host=[DOMAIN]\u0026path=[UUID2]#[TAB] 这样的链接，如果我们使用 v2rayA 进行解析（自动分开各个部分），就会发现实际上是这个意思：\n那么根据 Clash 对应格式，就应该写为：\nproxies: - name: \"any_name_is_okay\" type: vless server: [DOMAIN] port: [PORT] uuid: [UUID] udp: true tls: true network: ws servername: [DOMAIN] ws-opts: path: \"/[UUID]\" headers: Host: [DOMAIN] 如果您使用的方案与本蛾子不相同，请您查看参考中的 GitLab 仓库，其中有最常见的 13 种代理的配置模板。\n这部分没什么好说的，本蛾子也变不出来新的订阅 🧙‍♂️\n🧭 策略组 如果您使用机场，机场应当已经给您配置好了，直接下载即可。如果您需要自定义，也可以在网上搜一搜好用的模板，直接下载即可。对于本蛾子自建节点来说，就不需要了（只有一个节点）😄\n只需要添加一个 PROXY 组，代表使用代理，Clash 内置了 REJECT 和 DIRECT 组，分别表示「拒绝连接」和「直接连接」。\nproxy-groups: - name: \"PROXY\" type: select proxies: - \"any_name_is_okay\" 🔌 分流规则 这应该是这篇文章的重头戏了！毕竟本蛾子写这篇文章就是因为吃了没有做好分流的苦。\n⚠️ 注意：部分站点（如 ChatGPT）会到处连接来确定您是否位于 OpenAI 不提供服务的区域。在这种情况下，建议启用全局代理。\n由于网站的数量是无限的，无论是您还是本蛾子还是网上的大神，这部分配置大概都不是一个字一个字打出来的，因此我们直接采用别人搞好的规则集。本蛾子搜了一圈，好像比较好用的是 Loyalsoldier/clash-rules（链接请见参考），如下配置：\n本蛾子采用了全套配置，可能稍有多于，您可以自行删除一部分\nrule-providers: reject: type: http behavior: domain url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt\" path: ./ruleset/reject.yaml interval: 86400 icloud: type: http behavior: domain url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt\" path: ./ruleset/icloud.yaml interval: 86400 apple: type: http behavior: domain url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt\" path: ./ruleset/apple.yaml interval: 86400 google: type: http behavior: domain url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt\" path: ./ruleset/google.yaml interval: 86400 proxy: type: http behavior: domain url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt\" path: ./ruleset/proxy.yaml interval: 86400 direct: type: http behavior: domain url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt\" path: ./ruleset/direct.yaml interval: 86400 private: type: http behavior: domain url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt\" path: ./ruleset/private.yaml interval: 86400 gfw: type: http behavior: domain url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt\" path: ./ruleset/gfw.yaml interval: 86400 tld-not-cn: type: http behavior: domain url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt\" path: ./ruleset/tld-not-cn.yaml interval: 86400 telegramcidr: type: http behavior: ipcidr url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt\" path: ./ruleset/telegramcidr.yaml interval: 86400 cncidr: type: http behavior: ipcidr url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt\" path: ./ruleset/cncidr.yaml interval: 86400 lancidr: type: http behavior: ipcidr url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt\" path: ./ruleset/lancidr.yaml interval: 86400 applications: type: http behavior: classical url: \"https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt\" path: ./ruleset/applications.yaml interval: 86400 以上是对规则集的引用。\ntype：规则集的协议类别，本文均为针对 HTTP。 behavior：规则集的内容类别。 url：下载地址，本文选择使用 jsDelivr 的源。 path：下载的规则集的保存位置。 interval：更新时间间隔，这个规则集使用 GitHub Actions 每天更新一次，因此我们也每天重新下载一次。 下面需要继续添加规则，来使用这些规则集：\nrules: - RULE-SET,applications,DIRECT - RULE-SET,private,DIRECT - RULE-SET,reject,REJECT - RULE-SET,icloud,DIRECT - RULE-SET,apple,DIRECT - RULE-SET,google,PROXY - RULE-SET,proxy,PROXY - RULE-SET,direct,DIRECT - RULE-SET,lancidr,DIRECT - RULE-SET,cncidr,DIRECT - RULE-SET,telegramcidr,PROXY - GEOIP,LAN,DIRECT - GEOIP,CN,DIRECT - MATCH,PROXY 由于本蛾子不适用 YACD 面板，以上规则集删除了两个 YACD 面板的域名。\n这个部分应该很好理解：\nRULE-SET，GEOIP，GEOSITE 或 DOMAIN 表示匹配的类型。 后面是匹配的属性。 DIRECT，REJECT 和 PROXY 分别代表「直接访问」「拒绝访问」和「使用代理访问」。 本蛾子是 Arch Linux 用户，需要不时使用 BFSU、USTC 或者 TUNA 的源进行更新，并且本蛾子不希望使用代理下载包（容易中断，而且浪费流量），因此额外添加了几条：\nrules: ... - DOMAIN,mirrors.bfsu.edu.cn,DIRECT - DOMAIN,mirrors.ustc.edu.cn,DIRECT - DOMAIN,mirrors.tuna.tsinghua.edu.cn,DIRECT 以上是白名单模式，因此不在列表中的域名会自动采用代理。\n🎆 下课 经过这些配置，应该差不多就可以顺利地使用代理了！\n这些只是最基本的配置，Clash Meta 内核还在不断发展，也不断有新的协议和工具出现。本蛾子建议您看看结尾的参考文章，相信能给您更多启发！\n💡 提示：本文不提供完整的样板。本蛾子认为配置 Clash 是一个非常个人化的工作，没有所谓的「最佳实践」。请您认真阅读本文，相信您可以配置得比本蛾子更好！\n➕ 本文参考或引用了以下来源：\n【保姆级教学】掰碎了给你讲！Clash配置文件详解（含实战演练）（原作者：崔裕姝）\nLoyalsoldier/clash-rules: 🦄️ 🎃 👻 Clash Premium 规则集(RULE-SET)，兼容 ClashX Pro、Clash for Windows 等基于 Clash Premium 内核的客户端。（原作者：Loyalsoldier）\nClash 知识库（原作者：原文未标注，疑似Dreamacro）\nDNS 污染和劫持原理（原作者：人身如逆旅，我亦是行人）\n防火长城域名服务器缓存污染 IP 列表（维基学院）\nMisaka-blog/clash-meta: 这是一个基于 Clash Meta 订阅的配置文件模板（原作者：Misaka-blog，博客已删）\n",
  "wordCount" : "734",
  "inLanguage": "zh-cn",
  "datePublished": "2024-12-29T09:39:37+08:00",
  "dateModified": "2024-12-29T09:39:37+08:00",
  "author":{
    "@type": "Person",
    "name": "智慧的幺蛾子"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/eeace13dad/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "桶装幺蛾子",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.jpg"
    }
  }
}
</script>
</head>

<body class="" id="top"><link rel="stylesheet" href="/js/katex/katex.min.css">
<script defer src="/js/katex/katex.min.js"></script>
<script defer src="/js/katex/contrib/auto-render.js" onload="renderMathInElement(document.body);"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError : false
            });
        });
</script>
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="🥫 桶装幺蛾子 (Alt + H)">🥫 桶装幺蛾子</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about" title="❓ 关于">
                    <span>❓ 关于</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives" title="📚 档案">
                    <span>📚 档案</span>
                </a>
            </li>
            <li>
                <a href="https://www.travellings.cn/go.html" title="🚆 开往">
                    <span>🚆 开往</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Clash 配置文件简述
    </h1>
    <div class="post-meta"><span title='2024-12-29 09:39:37 +0800 CST'>December 29, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;智慧的幺蛾子

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#-%e5%ae%a2%e6%88%b7%e7%ab%af%e9%80%89%e6%8b%a9" aria-label="💻 客户端选择">💻 客户端选择</a></li>
                <li>
                    <a href="#-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="⚙️ 配置文件">⚙️ 配置文件</a><ul>
                        
                <li>
                    <a href="#-%e5%9f%ba%e7%a1%80" aria-label="🏠 基础">🏠 基础</a></li></ul>
                </li>
                <li>
                    <a href="#-dns" aria-label="🗺️ DNS">🗺️ DNS</a><ul>
                        
                <li>
                    <a href="#-%e4%bb%a3%e7%90%86" aria-label="👷‍♂️ 代理">👷‍♂️ 代理</a></li>
                <li>
                    <a href="#-%e7%ad%96%e7%95%a5%e7%bb%84" aria-label="🧭 策略组">🧭 策略组</a></li>
                <li>
                    <a href="#-%e5%88%86%e6%b5%81%e8%a7%84%e5%88%99" aria-label="🔌 分流规则">🔌 分流规则</a></li></ul>
                </li>
                <li>
                    <a href="#-%e4%b8%8b%e8%af%be" aria-label="🎆 下课">🎆 下课</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>最近本蛾子发现之前搭建的代理，访问部分国内网站的时候不光速度很慢，而且有时候会报 PR_END_OF_FILE_ERROR（无法确定内容完整性，就是远程，特别是 CSDN，全站都无法访问。</p>
<blockquote>
<p>😮‍💨 唉：后来发现其实是服务端 WARP 的问题，跟 v2rayA 一毛钱关系都没有。</p>
</blockquote>
<p>本蛾子现在使用的 v2rayA 虽然安装起来很方便（Arch Linux CN 有打包），但是对于规则的支持并不算好，并且开启、关闭、切换节点的速度也不尽人意。在网上搜索一通，似乎眼下最完善的内核是 Clash 系列的后继者 Mihomo，因此本蛾子就用它来学习一下<strong>如何书写 Clash 配置文件</strong>。</p>
<h2 id="-客户端选择">💻 客户端选择<a hidden class="anchor" aria-hidden="true" href="#-客户端选择">#</a></h2>
<p>Clash 系的客户端在 AUR 上基本全部都有打包。根据本蛾子的测试，似乎还在开发且可用性比较高的，只有 Clash Verge Rev 和 FlClash，而后者的 UI 设计本蛾子看着非常舒服，因此本文就以 FlClash 作为测试客户端。</p>
<p>首先对 FlClash 的软件设置进行调整。虽然诸多 Clash 系客户端使用同一个内核，但是其 UI 设计却千差万别。FlClash 的界面大概是这样的。</p>
<p><img alt="image-20241229103214948" loading="lazy" src="../../static/img/eeace13dad.d/image-20241229103214948.png"></p>
<p>在 Tools 栏目中，主要是软件本身和覆写配置文件的选项，前者是主题、日志、自动启动等本地定义的选项，不出现在配置文件中，因此我们首先来完成对其的设置。覆写配置文件的设置主要针对使用远程配置文件（例如机场）的用户，方便修改配置文件。</p>
<!-- raw HTML omitted -->
<p>选项大部分您都应该能理解，说几个比较迷惑的：</p>
<ul>
<li>Logcat：就是日志功能，记录您使用代理访问的网站，关闭之后不会记录，但是似乎需要手动删除之前的记录（位于您的主目录下）。</li>
<li>Auto lost connections：在切换节点之后切断当前存在的连接，开启之后换区域会更加彻底，但是您的下载会被终端。</li>
<li>Only statistics proxy：只对通过的流量进行记录，这时候 FlClash 就变成了一个网络监测工具。</li>
</ul>
<p>当然这个栏目还有其他功能，比如设置语言、主题、备份之类的，就请您自己探索了。</p>
<h2 id="-配置文件">⚙️ 配置文件<a hidden class="anchor" aria-hidden="true" href="#-配置文件">#</a></h2>
<p>这当然就是本文的重点了！通过 Clash 配置文件，您可以方便地修改 DNS、分流、（基础）去广告等，至于节点链接，倒成了配置文件中不太重要的一部分了。下面本蛾子参考了一些链接和项目，为行文流畅就不一一列出角标了，一并在文末引用。</p>
<p>您书写的配置文件应当保存在任意名称的 <code>.yaml</code> 文件中，在 FlClash 中这样引用：</p>
<p><img alt="image-20241229111508530" loading="lazy" src="../../static/img/eeace13dad.d/image-20241229111508530.png"></p>
<p><img alt="image-20241229111702011" loading="lazy" src="../../static/img/eeace13dad.d/image-20241229111702011.png"></p>
<h3 id="-基础">🏠 基础<a hidden class="anchor" aria-hidden="true" href="#-基础">#</a></h3>
<p>Clash 配置文件使用 YAML 的语法，以 <code>key: value</code> 的形式书写，注意中间的空格不可以省略。如果一个键有子键，那么需要缩进并添加 <code>-</code>；注释以 <code>#</code> 开头。示例请见下文说明。</p>
<p>一个 Clash 配置文件类似于这样：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">mixed-port</span><span class="p">:</span><span class="w"> </span><span class="m">7890</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">allow-lan</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># bind-address: &#34;*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">ipv6</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">rule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">log-level</span><span class="p">:</span><span class="w"> </span><span class="l">info</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># external-controller: 127.0.0.1:9090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># secret:&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">dns</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">proxies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">proxy-groups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><p>每一个选项的含义：</p>
<ul>
<li><code>mixed-port</code>：混合端口，即 Clash 内核所使用的端口，支持 HTTP、SOCKS 等代理协议混用。</li>
<li><code>allow-lan</code>：是否允许局域网连接，如果您希望连接其他设备可以连接代理，您应当将其设置为 <code>true</code>，公用网络下无论如何都应当设置为 <code>false</code> 来保证安全。</li>
<li><code>bind-address</code>：绑定地址，在 <code>allow-lan: true</code> 的情况下，端口允许的地址，例如 <code>0.0.0.0</code> 代表您设备在网络中的 IP 地址（所有 IPv4 设备均可连接），<code>127.0.0.1</code> 代表回环地址（只有本机可以连接），<code>::</code> 代表您设备的 IPv6 地址等等；设置为 <code>&quot;*&quot;</code> 即允许所有设备连接。</li>
<li><code>ipv6</code>：是否启用 IPv6，这要看您路由器是否支持。设为 <code>true</code> 没啥坏处。</li>
<li><code>mode</code>：模式，接下来我们将使用规则集，因此要设成 <code>rule</code> 即规则模式。其他还有 <code>direct</code>（不走代理）和 <code>global</code>（全走代理）。</li>
<li><code>log-level</code>：日志等级，<code>info</code> 比较适中，也可设成 <code>error</code>（仅错误）、<code>warning</code>（错误和警告）、<code>debug</code>（所有记录）、<code>silent</code>（不输出）。</li>
<li><code>external-controller</code> 和 <code>secret</code>：控制端口和密码，非常建议设置为 <code>127.0.0.1</code> 而非 <code>0.0.0.0</code>，后者将把控制界面向局域网开放。</li>
<li>其他的是接下来讨论的重点。</li>
</ul>
<p>当然其实还有个 <code>authentication</code> 即代理认证功能，请您自行查阅文末引用，有详细介绍。本文主要讨论作为本地代理的功能，不过度介绍。</p>
<h2 id="-dns">🗺️ DNS<a hidden class="anchor" aria-hidden="true" href="#-dns">#</a></h2>
<p>在上述配置中继续添加。</p>
<p>DNS 是互联网上用于查找域名对应 IP 地址的工具，您在浏览器中输入的所有域名都会被发送到 DNS 服务器解析，然后再访问 IP。由于纯 DNS 使用的是未经加密的 UDP 包，非常容易被污染篡改，早年间的 GFW 主要就采用 DNS 污染的方式封禁域名。</p>
<p>说实话，本蛾子建议您就算不使用代理，也按照下文方法（在 FlClash 或操作系统中）设置安全的 DNS 方案，详情请见文末引用的部分文章。</p>
<p>但是后来由于 DoH 即 DNS over HTTPS 技术的出现（其实还有 HTTPS 本身），GFW 原本准确的 DNS 污染和选择性屏蔽页面形同虚设，就开始使用 IP 黑洞这种最简单、最暴力的方法屏蔽一些网站。</p>
<blockquote>
<p>当然对于 Cloudflare 这种 IP 大户还是没什么用，于是对于 <code>*.pages.dev</code> 和 <code>*.workers.dev</code> 又开始了域名封锁。</p>
</blockquote>
<p>无论如何，您在使用代理时，最好还是要添加一下 DNS 配置。例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">dns</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">prefer-h3</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">use-hosts</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">use-system-hosts</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">respect-rules</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">listen</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.0.0</span><span class="p">:</span><span class="m">1053</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ipv6</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">enhanced-mode</span><span class="p">:</span><span class="w"> </span><span class="l">fake-ip</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">fake-ip-range</span><span class="p">:</span><span class="w"> </span><span class="m">198.18.0.1</span><span class="l">/16</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  fake-ip-filter:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#    - &#39;*.lan&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#    - &#34;+.local&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#    - localhost.ptlogin2.qq.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">default-nameserver</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">8.8.8.8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">1.1.1.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">223.5.5.5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">119.29.29.29</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># nameserver-policy:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   &#39;www.baidu.com&#39;: &#39;114.114.114.114&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   &#39;+.internal.crop.com&#39;: &#39;10.0.0.1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   &#39;geosite:cn,private&#39;:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   - https://223.5.5.5/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   - https://223.6.6.6/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">nameserver</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">https://dns.alidns.com/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">https://doh.pub/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">proxy-server-nameserver</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">https://dns.alidns.com/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">https://doh.pub/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">fallback</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">https://dns.google/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">https://cloudflare-dns.com/dns-query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">8.8.8.8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">1.1.1.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">fallback-filter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">geoip</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">geoip-code</span><span class="p">:</span><span class="w"> </span><span class="l">CN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">geosite</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">gfw</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ipcidr</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">240.0.0.0</span><span class="l">/4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0.0.0</span><span class="l">/32</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">127.0.0.1</span><span class="l">/32</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#    domain:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#      - &#39;+.google.com&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#      - &#39;+.facebook.com&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#      - &#39;+.youtube.com&#39;</span><span class="w">
</span></span></span></code></pre></div><p>简单解释一下：</p>
<ul>
<li>
<p><code>enable</code>：启用 DNS 设置。</p>
</li>
<li>
<p><code>prefer-h3</code>：加密的、使用 QUIC 实现的 DNS 协议，有助于加快查询速度。</p>
</li>
<li>
<p><code>use-hosts</code> 和 <code>use-system-hosts</code>：是否使用 <code>hosts</code> 优先查询。<code>hosts</code> 是独立于 DNS 系统的查询文件，一般在操作系统中定义，可以把某些地址强制解析到特定 IP 上，例如实际上 <code>localhost</code> 这个地址并不存在，是操作系统在 <code>hosts</code> 中定义了 <code>127.0.0.1 localhost</code>。建议开启。</p>
</li>
<li>
<p><code>respect-rules</code>：优先遵守下文规则的设置，如果您使用机场，不建议开启，因为如果机场定义了 DNS 设置会导致您的配置失效。（如果没有，就无所谓了，这玩意儿就成了「自尊」😄）</p>
</li>
<li>
<p><code>fake-ip-*</code>：这是个比较有意思的东西。正常来说，浏览器查询 DNS 服务器，得到 IP，然后访问；但是如果 Clash 开启了 <code>fake-ip</code>，浏览器得到 Clash 的解析结果都指向 <code>fake-ip-range</code> 中的一个随机地址，然后对其发送请求，再由 Clash 来请求服务端。</p>
<blockquote>
<p>由此也可以发现，Clash 运行时一定会劫持 DNS，所以如果您发现 DNS 设置不正常，不必惊慌。</p>
</blockquote>
<p><code>fake-ip-filter</code> 还可以定义不使用 <code>fake-ip</code> 的地址，一般不需要，除了 QQ 对于本地的请求也使用域名……</p>
</li>
<li>
<p><code>default-nameserver</code>：如果定义了 <code>nameserver</code>，此配置将用于解析 DoH 域名，从上至下轮询直到得到第一个结果。由于我们使用代理，就优先选择国外服务；如果您想配置不开代理的 DoH，需要将国内的几个调到上面。</p>
<blockquote>
<p>DoH 地址也是域名，也需要解析……所以有的时候称为「引导域名服务器」。</p>
</blockquote>
</li>
<li>
<p><code>nameserver</code>：默认 DNS 服务器，但是由于下文设置了 <code>fallback-filter</code>，所有 GeoIP 非 CN 的域名实际上会采用 <code>fallback</code>，因此这里仅针对国内网站。</p>
</li>
<li>
<p><code>nameserver-policy</code>：域名解析规则，对于特定域名采用指定 DNS 服务器。</p>
</li>
<li>
<p><code>proxy-server-nameserver</code>：用于解析代理服务器域名的 DNS 服务器，建议设国内地址，因为这个流量不走代理。</p>
</li>
<li>
<p><code>fallback</code>：后备 DNS 服务器。若第一轮解析结果显示其 GeoIP 非 CN，则使用这些服务器验证。</p>
</li>
<li>
<p><code>fallback-filter</code>：过滤器，负责决定哪些域名需要使用 <code>fallback</code> 验证：</p>
<ul>
<li>
<p><code>geoip-code</code>：<strong>除了</strong>该国家代码的解析结果，全部视为已经污染，进入 <code>fallback</code>。</p>
</li>
<li>
<p><code>geosite</code>：在列表中的全部视为污染，进入 <code>fallback</code>。</p>
</li>
<li>
<p><code>ipcidr</code>：如果解析结果是这些网段，则认为是污染。</p>
<blockquote>
<p>这是因为 GFW 在 DNS 污染之后还是要返回结果的，通常就是回环地址或者不存在的 IP，因此可以根据这一点来判断是否被污染。文末的维基学院参考提供了一个污染返回的结果列表，但是本蛾子未采用，因为该列表有极大概率滥杀无辜 😮‍💨</p>
</blockquote>
</li>
<li>
<p><code>domain</code>：对于这些域名，直接使用 <code>fallback</code>。</p>
</li>
</ul>
</li>
</ul>
<h3 id="-代理">👷‍♂️ 代理<a hidden class="anchor" aria-hidden="true" href="#-代理">#</a></h3>
<p>这里你应当填写你的订阅链接。如果您获得的链接是类似于 <code>vless://...</code> 的格式，您需要先进行转换。下面本蛾子给出一个示范。</p>
<p>对于 <code>vless://[UUID]@[DOMAIN]:[PORT]?encryption=[ENCRYPTION]&amp;security=[SECURITY]&amp;type=[TYPE]&amp;host=[DOMAIN]&amp;path=[UUID2]#[TAB]</code> 这样的链接，如果我们使用 v2rayA 进行解析（自动分开各个部分），就会发现实际上是这个意思：</p>
<!-- raw HTML omitted -->
<p>那么根据 Clash 对应格式，就应该写为：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">proxies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;any_name_is_okay&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">vless</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">DOMAIN]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">PORT]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">uuid</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">UUID]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">udp</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">network</span><span class="p">:</span><span class="w"> </span><span class="l">ws</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">servername</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">DOMAIN]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ws-opts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/[UUID]&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">headers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">Host</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">DOMAIN]</span><span class="w">
</span></span></span></code></pre></div><p>如果您使用的方案与本蛾子不相同，请您查看参考中的 GitLab 仓库，其中有最常见的 13 种代理的配置模板。</p>
<p>这部分没什么好说的，本蛾子也变不出来新的订阅 🧙‍♂️</p>
<h3 id="-策略组">🧭 策略组<a hidden class="anchor" aria-hidden="true" href="#-策略组">#</a></h3>
<p>如果您使用机场，机场应当已经给您配置好了，直接下载即可。如果您需要自定义，也可以在网上搜一搜好用的模板，直接下载即可。对于本蛾子自建节点来说，就不需要了（只有一个节点）😄</p>
<p>只需要添加一个 PROXY 组，代表使用代理，Clash 内置了 REJECT 和 DIRECT 组，分别表示「拒绝连接」和「直接连接」。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">proxy-groups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;PROXY&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">proxies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;any_name_is_okay&#34;</span><span class="w">
</span></span></span></code></pre></div><h3 id="-分流规则">🔌 分流规则<a hidden class="anchor" aria-hidden="true" href="#-分流规则">#</a></h3>
<p>这应该是这篇文章的重头戏了！毕竟本蛾子写这篇文章就是因为吃了没有做好分流的苦。</p>
<blockquote>
<p>⚠️ 注意：部分站点（如 ChatGPT）会到处连接来确定您是否位于 OpenAI 不提供服务的区域。在这种情况下，建议启用全局代理。</p>
</blockquote>
<p>由于网站的数量是无限的，无论是您还是本蛾子还是网上的大神，这部分配置大概都不是一个字一个字打出来的，因此我们直接采用别人搞好的规则集。本蛾子搜了一圈，好像比较好用的是 Loyalsoldier/clash-rules（链接请见参考），如下配置：</p>
<blockquote>
<p>本蛾子采用了全套配置，可能稍有多于，您可以自行删除一部分</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">rule-providers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">reject</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/reject.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">icloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/icloud.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">apple</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/apple.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">google</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/google.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">proxy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/proxy.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">direct</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/direct.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">private</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/private.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">gfw</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/gfw.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tld-not-cn</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">domain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/tld-not-cn.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">telegramcidr</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">ipcidr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/telegramcidr.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cncidr</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">ipcidr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/cncidr.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">lancidr</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">ipcidr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/lancidr.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">applications</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l">classical</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./ruleset/applications.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="m">86400</span><span class="w">
</span></span></span></code></pre></div><p>以上是对规则集的引用。</p>
<ul>
<li><code>type</code>：规则集的协议类别，本文均为针对 HTTP。</li>
<li><code>behavior</code>：规则集的内容类别。</li>
<li><code>url</code>：下载地址，本文选择使用 jsDelivr 的源。</li>
<li><code>path</code>：下载的规则集的保存位置。</li>
<li><code>interval</code>：更新时间间隔，这个规则集使用 GitHub Actions 每天更新一次，因此我们也每天重新下载一次。</li>
</ul>
<p>下面需要继续添加规则，来使用这些规则集：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,applications,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,private,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,reject,REJECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,icloud,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,apple,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,google,PROXY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,proxy,PROXY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,direct,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,lancidr,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,cncidr,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">RULE-SET,telegramcidr,PROXY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">GEOIP,LAN,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">GEOIP,CN,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">MATCH,PROXY</span><span class="w">
</span></span></span></code></pre></div><blockquote>
<p>由于本蛾子不适用 YACD 面板，以上规则集删除了两个 YACD 面板的域名。</p>
</blockquote>
<p>这个部分应该很好理解：</p>
<ul>
<li><code>RULE-SET</code>，<code>GEOIP</code>，<code>GEOSITE</code> 或 <code>DOMAIN</code> 表示匹配的类型。</li>
<li>后面是匹配的属性。</li>
<li><code>DIRECT</code>，<code>REJECT</code> 和 <code>PROXY</code> 分别代表「直接访问」「拒绝访问」和「使用代理访问」。</li>
</ul>
<p>本蛾子是 Arch Linux 用户，需要不时使用 BFSU、USTC 或者 TUNA 的源进行更新，并且本蛾子不希望使用代理下载包（容易中断，而且浪费流量），因此额外添加了几条：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">DOMAIN,mirrors.bfsu.edu.cn,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">DOMAIN,mirrors.ustc.edu.cn,DIRECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">DOMAIN,mirrors.tuna.tsinghua.edu.cn,DIRECT</span><span class="w">
</span></span></span></code></pre></div><p>以上是白名单模式，因此不在列表中的域名会自动采用代理。</p>
<h2 id="-下课">🎆 下课<a hidden class="anchor" aria-hidden="true" href="#-下课">#</a></h2>
<p>经过这些配置，应该差不多就可以顺利地使用代理了！</p>
<p>这些只是最基本的配置，Clash Meta 内核还在不断发展，也不断有新的协议和工具出现。本蛾子建议您看看结尾的参考文章，相信能给您更多启发！</p>
<blockquote>
<p>💡 提示：本文不提供完整的样板。本蛾子认为配置 Clash 是一个非常个人化的工作，没有所谓的「最佳实践」。请您认真阅读本文，相信您可以配置得比本蛾子更好！</p>
</blockquote>
<blockquote>
<p>➕ 本文参考或引用了以下来源：</p>
<p><a href="https://linux.do/t/topic/163682">【保姆级教学】掰碎了给你讲！Clash配置文件详解（含实战演练）</a>（原作者：<a href="https://linux.do/u/Yuju">崔裕姝</a>）</p>
<p><a href="https://github.com/Loyalsoldier/clash-rules">Loyalsoldier/clash-rules: 🦄️ 🎃 👻 Clash Premium 规则集(RULE-SET)，兼容 ClashX Pro、Clash for Windows 等基于 Clash Premium 内核的客户端。</a>（原作者：<a href="https://github.com/Loyalsoldier">Loyalsoldier</a>）</p>
<p><a href="https://clash.wiki/">Clash 知识库</a>（原作者：原文未标注，疑似<a href="https://github.com/Dreamacro">Dreamacro</a>）</p>
<p><a href="https://xiking.win/2019/03/27/dns-cache-pollution/">DNS 污染和劫持原理</a>（原作者：<a href="https://xiking.win/">人身如逆旅，我亦是行人</a>）</p>
<p><a href="https://zh.wikiversity.org/wiki/%E9%98%B2%E7%81%AB%E9%95%BF%E5%9F%8E%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%93%E5%AD%98%E6%B1%A1%E6%9F%93IP%E5%88%97%E8%A1%A8">防火长城域名服务器缓存污染 IP 列表</a>（<a href="https://zh.wikiversity.org">维基学院</a>）</p>
<p><a href="https://gitlab.com/Misaka-blog/clash-meta">Misaka-blog/clash-meta: 这是一个基于 Clash Meta 订阅的配置文件模板</a>（原作者：<a href="https://gitlab.com/Misaka-blog">Misaka-blog</a>，博客已删）</p>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/fdf8cb41df/">
    <span class="title">« </span>
    <br>
    <span>使用单板机为旧打印机添加局域网共享</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/5baaf9322f/">
    <span class="title"> »</span>
    <br>
    <span>使用 SSH 公钥登录服务器并禁用密码</span>
  </a>
</nav>
<img src="/static/img/signature.png">


  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://creativecommons.org/public-domain/cc0/">CC0</a> 授权，允许您自由使用。</span>
    <br>
    <span><a href="https://icp.gov.moe/?keyword=20252048" target="_blank">萌ICP备20252048号</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
