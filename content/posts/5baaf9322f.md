---
date: '2024-12-15T16:50:12+08:00'
draft: false
title: 'ä½¿ç”¨ SSH å…¬é‘°ç™»éŒ„æœå‹™å™¨ä¸¦ç¦ç”¨å¯†ç¢¼'
typora-copy-images-to: '../../static/img/${filename}.d'
---

ğŸ˜  **å¤ªé•·ä¸è®€**ï¼šç”Ÿæˆ SSHå¯†é‘°ï¼Œä¸Šå‚³åˆ°æœå‹™å™¨ï¼Œç„¶å¾Œç¦ç”¨å¯†ç¢¼ç™»éŒ„ã€‚ï¼ˆå¥½åƒæ˜¯å»¢è©±ï¼‰

## 0x01 ğŸ”’ ç”Ÿæˆ SSH å¯†é‘°

> ä»¥ä¸‹ä½¿ç”¨ `$` ç¬¦è™Ÿä»£è¡¨æœ¬æ©ŸåŸ·è¡Œï¼Œ`>` ç¬¦è™Ÿä»£è¡¨æœå‹™å™¨åŸ·è¡Œã€‚

```
$ ssh-keygen # èˆŠç‰ˆæœ¬éœ€è¦æ·»åŠ  `-t ed25519` åƒæ•¸
Generating public/private ed25519 key pair.
Enter file in which to save the key (/home/YOUR_USER_NAME/.ssh/id_ed25519): # å¯ä»¥è‡ªå®šç¾©ä½ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å›è»Š
Enter passphrase for "example" (empty for no passphrase): # è¼¸å…¥å¯†ç¢¼ï¼ˆä¸é¡¯ç¤ºï¼‰ï¼Œä¸å»ºè­°ç©ºå¯†ç¢¼
Enter same passphrase again: # å†è¼¸ä¸€é
Your identification has been saved in id_ed25519
Your public key has been saved in id_ed25519.pub # å¸¶æœ‰ .pub çš„æ˜¯å…¬é‘°
The key fingerprint is:
SHA256:SOME_STRANGE_STRING YOUR_USER_NAME@YOUR_HOST_NAME # ä½ çš„å…¬é‘°æŒ‡ç´‹
The key's randomart image is: # æ ¹æ“šå…¬é‘°ç”Ÿæˆçš„éš¨æ©Ÿåœ–åƒ
+--[ED25519 256]--+
|       SOME      |
|     STRANGE     |
|      IMAGE      |
|                 |
|                 |
|                 |
|                 |
|                 |
|                 |
+----[SHA256]-----+

$ ls .ssh
id_ed25519 id_ed25519 # å¯èƒ½é‚„æœ‰å…¶ä»–æ–‡ä»¶
```

## 0x02 â¬†ï¸ ä¸Šå‚³åˆ°æœå‹™å™¨

é¦–å…ˆç¢ºä¿ä½ ç•¶å‰å¯ä»¥ä½¿ç”¨å¯†ç¢¼ç™»éŒ„ä¸€å€‹**é root** çš„è³¬è™Ÿã€‚

```
$ ssh example_user@example_host
example_user@example_host's password: 
>
```

ç„¶å¾Œï¼Œé€€å‡º SSHï¼Œåœ¨æœ¬æ©Ÿä¸ŠåŸ·è¡Œï¼ˆæ³¨æ„æ˜¯æœ¬æ©Ÿï¼‰ï¼š

```
$ ssh-copy-id -i .ssh/id_ed25519.pub example_user@example_host
```

åœ¨ä¸Šå‚³éç¨‹ä¸­ï¼Œæœƒè¦æ±‚ä½ è¼¸å…¥ç•¶å‰å¯†ç¢¼ã€‚ä¸€èˆ¬ä¾†èªªå¾ˆå¿«å°±æœƒä¸Šå‚³å®Œæˆã€‚

æ¸¬è©¦ä¸€ä¸‹æ˜¯å¦å¯ä»¥ç™»éŒ„ã€‚

```
$ ssh -i .ssh/id_ed25519.pub example_user@example_host
.ssh/id_ed25519.pub's password: # æ³¨æ„é€™è£è®Šæˆè¼¸å…¥å¯†é‘°çš„å¯†ç¢¼äº†
>
```

å¦‚æœå¯ä»¥ï¼Œç¹¼çºŒä¸‹ä¸€æ­¥ã€‚

## 0x03 ğŸ™…â€â™‚ï¸ ç¦ç”¨å¯†ç¢¼ç™»éŒ„

```
> sudo vim /etc/ssh/sshd_config
```

åœ¨ç·¨è¼¯å™¨ä¸­ï¼Œæ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹é¸é …ï¼š

```
PasswordAuthentication no
PermitRootLogin no
AllowPAM no
AllowUsers example_user # å¯é¸ï¼Œé€™å°‡ç¦æ­¢é™¤ example_user ä¹‹å¤–ä»»ä½•ç”¨æˆ¶ SSH ç™»éŒ„
```

ä¿å­˜ä¸¦é€€å‡ºï¼Œç„¶å¾Œï¼š

```
> sudo systemctl restart sshd
```

é€€å‡º SSHï¼Œå†æ¬¡å˜—è©¦ç™»éŒ„ï¼š

```
$ ssh example_user@example_host
example_user@example_host: Permission denied (publickey).
```

å†æ¬¡ä½¿ç”¨å¯†é‘°ç™»éŒ„ï¼Œå¦‚æœç™»éŒ„æˆåŠŸï¼Œé‚£éº¼èªªæ˜ä»¥ä¸Šæ­¥é©Ÿéƒ½æ˜¯æ­£ç¢ºçš„ï¼

> â“ å¦‚æœä¸è¡Œå‘¢ï¼Ÿæ­å–œä½  ğŸ‰ ä½ è¢«é–åœ¨ç³»çµ±ä¹‹å¤–äº†ï¼VNC ä½ çš„æœå‹™å™¨å§â€¦â€¦
>
> ![Security Holes](../../static/img/5baaf9322f.d/security_holes.png)
>
> ä¾†æºï¼š[XKCD](https://xkcd.com/424/)ï¼ŒåŸæ–‡è§£èªªæ˜¯ *True story: I had to try several times to upload this comic because my ssh key was blacklisted.*ã€‚

