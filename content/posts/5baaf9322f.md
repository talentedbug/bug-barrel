---
date: '2024-12-15T16:50:12+08:00'
draft: false
title: 'ä½¿ç”¨ SSH å…¬é’¥ç™»å½•æœåŠ¡å™¨å¹¶ç¦ç”¨å¯†ç '
typora-copy-images-to: '../../static/img/${filename}.d'
coverImage: '../../static/img/5baaf9322f.d/cover.jpg'
---

ğŸ˜  **å¤ªé•¿ä¸è¯»**ï¼šç”Ÿæˆ SSHå¯†é’¥ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶åç¦ç”¨å¯†ç ç™»å½•ã€‚ï¼ˆå¥½åƒæ˜¯åºŸè¯ï¼‰

## 0x01 ğŸ”’ ç”Ÿæˆ SSH å¯†é’¥

> ä»¥ä¸‹ä½¿ç”¨ `$` ç¬¦å·ä»£è¡¨æœ¬æœºæ‰§è¡Œï¼Œ`>` ç¬¦å·ä»£è¡¨æœåŠ¡å™¨æ‰§è¡Œã€‚

```
$ ssh-keygen # æ—§ç‰ˆæœ¬éœ€è¦æ·»åŠ  `-t ed25519` å‚æ•°
Generating public/private ed25519 key pair.
Enter file in which to save the key (/home/YOUR_USER_NAME/.ssh/id_ed25519): # å¯ä»¥è‡ªå®šä¹‰ä½ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å›è½¦
Enter passphrase for "example" (empty for no passphrase): # è¾“å…¥å¯†ç ï¼ˆä¸æ˜¾ç¤ºï¼‰ï¼Œä¸å»ºè®®ç©ºå¯†ç 
Enter same passphrase again: # å†è¾“ä¸€é
Your identification has been saved in id_ed25519
Your public key has been saved in id_ed25519.pub # å¸¦æœ‰ .pub çš„æ˜¯å…¬é’¥
The key fingerprint is:
SHA256:SOME_STRANGE_STRING YOUR_USER_NAME@YOUR_HOST_NAME # ä½ çš„å…¬é’¥æŒ‡çº¹
The key's randomart image is: # æ ¹æ®å…¬é’¥ç”Ÿæˆçš„éšæœºå›¾åƒ
+--[ED25519 256]--+
|       SOME      |
|     STRANGE     |
|      IMAGE      |
|                 |
|                 |
|                 |
|                 |
|                 |
|                 |
+----[SHA256]-----+

$ ls .ssh
id_ed25519 id_ed25519 # å¯èƒ½è¿˜æœ‰å…¶ä»–æ–‡ä»¶
```

## 0x02 â¬†ï¸ ä¸Šä¼ åˆ°æœåŠ¡å™¨

é¦–å…ˆç¡®ä¿ä½ å½“å‰å¯ä»¥ä½¿ç”¨å¯†ç ç™»å½•ä¸€ä¸ª**é root** çš„è´¦å·ã€‚

```
$ ssh example_user@example_host
example_user@example_host's password: 
>
```

ç„¶åï¼Œé€€å‡º SSHï¼Œåœ¨æœ¬æœºä¸Šæ‰§è¡Œï¼ˆæ³¨æ„æ˜¯æœ¬æœºï¼‰ï¼š

```
$ ssh-copy-id -i .ssh/id_ed25519.pub example_user@example_host
```

åœ¨ä¸Šä¼ è¿‡ç¨‹ä¸­ï¼Œä¼šè¦æ±‚ä½ è¾“å…¥å½“å‰å¯†ç ã€‚ä¸€èˆ¬æ¥è¯´å¾ˆå¿«å°±ä¼šä¸Šä¼ å®Œæˆã€‚

æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯ä»¥ç™»å½•ã€‚

```
$ ssh -i .ssh/id_ed25519.pub example_user@example_host
.ssh/id_ed25519.pub's password: # æ³¨æ„è¿™é‡Œå˜æˆè¾“å…¥å¯†é’¥çš„å¯†ç äº†
>
```

å¦‚æœå¯ä»¥ï¼Œç»§ç»­ä¸‹ä¸€æ­¥ã€‚

## 0x03 ğŸ™…â€â™‚ï¸ ç¦ç”¨å¯†ç ç™»å½•

```
> sudo vim /etc/ssh/sshd_config
```

åœ¨ç¼–è¾‘å™¨ä¸­ï¼Œæ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹é€‰é¡¹ï¼š

```
PasswordAuthentication no
PermitRootLogin no
AllowPAM no
AllowUsers example_user # å¯é€‰ï¼Œè¿™å°†ç¦æ­¢é™¤ example_user ä¹‹å¤–ä»»ä½•ç”¨æˆ· SSH ç™»å½•
```

ä¿å­˜å¹¶é€€å‡ºï¼Œç„¶åï¼š

```
> sudo systemctl restart sshd
```

é€€å‡º SSHï¼Œå†æ¬¡å°è¯•ç™»å½•ï¼š

```
$ ssh example_user@example_host
example_user@example_host: Permission denied (publickey).
```

å†æ¬¡ä½¿ç”¨å¯†é’¥ç™»å½•ï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œé‚£ä¹ˆè¯´æ˜ä»¥ä¸Šæ­¥éª¤éƒ½æ˜¯æ­£ç¡®çš„ï¼

> â“ å¦‚æœä¸è¡Œå‘¢ï¼Ÿæ­å–œä½  ğŸ‰ ä½ è¢«é”åœ¨ç³»ç»Ÿä¹‹å¤–äº†ï¼VNC ä½ çš„æœåŠ¡å™¨å§â€¦â€¦
>
> ![Security Holes](../../static/img/5baaf9322f.d/security_holes.png)
>
> æ¥æºï¼š[XKCD](https://xkcd.com/424/)ï¼ŒåŸæ–‡è§£è¯´æ˜¯ *True story: I had to try several times to upload this comic because my ssh key was blacklisted.*ã€‚

